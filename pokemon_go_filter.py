import sys
sys.path.append('androguard')

from androguard.core.bytecodes import apk

if len(sys.argv) != 2:
    print 'Please invoke the program as follows:'
    print 'python pokemon_go_filter.py <apk_file>'
    exit(1)

filename = sys.argv[1]
apk_file = apk.APK(filename)
permissions = apk_file.get_details_permissions()

#apk_hash = apk_file.get_hash()

permission_file = open('permissions.txt', 'r')
expected_permissions = set([s.strip() for s in permission_file.readlines()])

print '\n ========== \n'

print 'Extracting permissions of the app.'

for permission in permissions:
    print permission


print '\n ========== \n'

print 'Analyzing the permissions against the official app. \n'

dangerous_permissions = list()

for permission in permissions:
    if permission not in expected_permissions:
        dangerous_permissions.append(permission)

if len(dangerous_permissions) != 0:
    print '=========================='
    print 'THE APK MIGHT BE DANGEROUS!'
    print '=========================='
    print 'The following might be UNSAFE permissions requested by the app: \n'
    for permission in dangerous_permissions:
        print permission
else:
    print '=================='
    print 'The APK SEEMS SAFE'
    print '=================='


#print 'The hash is:',  apk_hash
